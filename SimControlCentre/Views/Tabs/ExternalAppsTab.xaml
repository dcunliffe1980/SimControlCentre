<UserControl x:Class="SimControlCentre.Views.Tabs.ExternalAppsTab"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
         xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
         xmlns:converters="clr-namespace:SimControlCentre.Converters"
         mc:Ignorable="d" 
         d:DesignHeight="600" d:DesignWidth="800">
<UserControl.Resources>
    <converters:ExecutableToIconConverter x:Key="ExeToIconConverter"/>
</UserControl.Resources>
<Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="Application Manager" 
                       FontSize="20" 
                       FontWeight="Bold" 
                       Margin="0,0,0,10"/>
            <TextBlock Text="Automatically start/stop applications when your sim racing software launches" 
                       FontSize="11" 
                       Foreground="Gray"/>
        </StackPanel>

        <!-- Sim Status -->
        <Border Grid.Row="1" 
                BorderBrush="LightGray" 
                BorderThickness="1" 
                Padding="10" 
                Background="WhiteSmoke"
                Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="Sim Status" FontWeight="Bold" Margin="0,0,0,10"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <Ellipse Name="iRacingStatusIndicator" 
                             Width="12" 
                             Height="12" 
                             Fill="Gray"
                             VerticalAlignment="Center"
                             Margin="0,0,10,0"/>
                    <TextBlock Name="iRacingStatusText" 
                               Text="Not Running" 
                               VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Enable/Disable Controls -->
                <StackPanel Margin="0,5,0,0">
                    <CheckBox Name="EnableStartWithSimCheckBox" 
                              Content="Enable 'Start with Sim' applications" 
                              IsChecked="True"
                              Margin="0,0,0,5"
                              Checked="EnableStartWithSim_Changed"
                              Unchecked="EnableStartWithSim_Changed"/>
                    <CheckBox Name="EnableStopWithSimCheckBox" 
                              Content="Enable 'Stop with Sim' applications" 
                              IsChecked="True"
                              Checked="EnableStopWithSim_Changed"
                              Unchecked="EnableStopWithSim_Changed"/>
                    <TextBlock Text="Tip: Disable these when watching replays" 
                               FontSize="10" 
                               Foreground="Gray" 
                               Margin="0,5,0,0" 
                               FontStyle="Italic"/>
                </StackPanel>
            </StackPanel>
        </Border>



        <!-- Apps List -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- START Apps -->
            <GroupBox Grid.Column="0" Header="Start with Sim" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- List of apps to start -->
                    <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                        <ItemsControl Name="StartAppsListBox">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="LightGray"
                                       BorderThickness="1"
                                       Padding="10"
                                       Margin="0,0,0,10"
                                       Background="White">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Icon and Status Indicator -->
                                        <Grid Grid.Column="0" Width="32" Height="32" Margin="0,0,10,0">
                                            <Border Background="White"
                                                   CornerRadius="4"
                                                   BorderBrush="LightGray"
                                                   BorderThickness="1">
                                                <Image Source="{Binding ExecutablePath, Converter={StaticResource ExeToIconConverter}}" 
                                                       Width="24" 
                                                       Height="24"
                                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                                            </Border>
                                            <!-- Running indicator (green dot in corner) -->
                                            <Ellipse Width="12" 
                                                    Height="12" 
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Bottom"
                                                    Margin="0,0,-2,-2"
                                                    Stroke="White"
                                                    StrokeThickness="1">
                                                <Ellipse.Style>
                                                    <Style TargetType="Ellipse">
                                                        <Setter Property="Fill" Value="Gray"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsRunning}" Value="True">
                                                                <Setter Property="Fill" Value="LimeGreen"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Ellipse.Style>
                                            </Ellipse>
                                        </Grid>

                                        <!-- App info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" 
                                                      FontWeight="Bold" 
                                                      FontSize="14"/>
                                            <TextBlock Text="{Binding ExecutablePath}" 
                                                      FontSize="10" 
                                                      Foreground="Gray"
                                                      TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>

                                        <!-- Test button -->
                                        <Button Grid.Column="2" 
                                               Content="Test" 
                                               Click="TestApp_Click"
                                               Tag="{Binding}"
                                               Padding="10,5"
                                               Margin="5,0"/>

                                        <!-- Edit button -->
                                        <Button Grid.Column="3" 
                                               Content="Edit" 
                                               Click="EditApp_Click"
                                               Tag="{Binding}"
                                               Padding="10,5"
                                               Margin="5,0"/>

                                        <!-- Delete button -->
                                        <Button Grid.Column="4" 
                                               Content="Delete" 
                                               Click="DeleteApp_Click"
                                               Tag="{Binding}"
                                               Padding="10,5"
                                               Margin="5,0,0,0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Add start app button -->
                <Button Grid.Row="1" 
                       Name="AddStartAppBtn"
                       Content="+ Add App to Start"
                       Click="AddStartApp_Click"
                       Padding="10,8"
                       Margin="0,10,0,0"
                       HorizontalAlignment="Stretch"/>
                </Grid>
            </GroupBox>

            <!-- STOP Apps -->
            <GroupBox Grid.Column="2" Header="Close with Sim" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- List of apps to stop -->
                    <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                        <ItemsControl Name="StopAppsListBox">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="LightGray"
                                           BorderThickness="1"
                                           Padding="10"
                                           Margin="0,0,0,10"
                                           Background="White">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Icon and Status -->
                                            <Grid Grid.Column="0" Width="32" Height="32" Margin="0,0,10,0">
                                                <Border Background="White"
                                                       CornerRadius="4"
                                                       BorderBrush="LightGray"
                                                       BorderThickness="1">
                                                    <Image Source="{Binding ExecutablePath, Converter={StaticResource ExeToIconConverter}}" 
                                                           Width="24" 
                                                           Height="24"
                                                           RenderOptions.BitmapScalingMode="HighQuality"/>
                                                </Border>
                                                <!-- Running indicator -->
                                                <Ellipse Width="12" 
                                                        Height="12" 
                                                        HorizontalAlignment="Right"
                                                        VerticalAlignment="Bottom"
                                                        Margin="0,0,-2,-2"
                                                        Stroke="White"
                                                        StrokeThickness="1">
                                                    <Ellipse.Style>
                                                        <Style TargetType="Ellipse">
                                                            <Setter Property="Fill" Value="Gray"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsRunning}" Value="True">
                                                                    <Setter Property="Fill" Value="LimeGreen"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Ellipse.Style>
                                                </Ellipse>
                                            </Grid>

                                            <!-- App info -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" 
                                                          FontWeight="Bold" 
                                                          FontSize="14"/>
                                                <TextBlock Text="{Binding ExecutablePath}" 
                                                          FontSize="10" 
                                                          Foreground="Gray"
                                                          TextTrimming="CharacterEllipsis"/>
                                            </StackPanel>

                                            <!-- Edit button -->
                                            <Button Grid.Column="2" 
                                                   Content="Edit" 
                                                   Click="EditApp_Click"
                                                   Tag="{Binding}"
                                                   Padding="10,5"
                                                   Margin="5,0"/>

                                            <!-- Delete button -->
                                            <Button Grid.Column="3" 
                                                   Content="Delete" 
                                                   Click="DeleteApp_Click"
                                                   Tag="{Binding}"
                                                   Padding="10,5"
                                                   Margin="5,0,0,0"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <!-- Add stop app button -->
                    <Button Grid.Row="1" 
                           Name="AddStopAppBtn"
                           Content="+ Add App to Close"
                           Click="AddStopApp_Click"
                           Padding="10,8"
                           Margin="0,10,0,0"
                           HorizontalAlignment="Stretch"/>
                </Grid>
            </GroupBox>
        </Grid>
    </Grid>
</UserControl>
