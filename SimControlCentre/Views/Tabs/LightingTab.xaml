<UserControl x:Class="SimControlCentre.Views.Tabs.LightingTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="20">
            <!-- Title -->
            <TextBlock Text="Lighting" 
                       FontSize="24" 
                       FontWeight="Bold" 
                       Margin="0,0,0,20"/>

            <!-- Enable/Disable -->
            <GroupBox Header="Settings" Padding="10" Margin="0,0,0,15">
                <StackPanel>
                    <CheckBox x:Name="EnableLightingCheckBox"
                              Content="Enable flag lighting"
                              Margin="0,0,0,10"
                              Checked="EnableLighting_Changed"
                              Unchecked="EnableLighting_Changed"/>
                    
                    <TextBlock Text="When enabled, connected lighting devices will display racing flag colors."
                               TextWrapping="Wrap"
                               Foreground="Gray"
                               FontSize="11"
                               Margin="0,0,0,15"/>
                    
                    <TextBlock Text="Enabled Plugins:"
                               FontWeight="SemiBold"
                               Margin="0,0,0,5"/>
                    
                    <!-- Plugin Enable/Disable -->
                    <CheckBox x:Name="EnableGoXlrPluginCheckBox"
                              Content="GoXLR Lighting"
                              IsChecked="True"
                              Checked="PluginEnabled_Changed"
                              Unchecked="PluginEnabled_Changed"
                              Tag="goxlr"
                              Margin="0,0,0,5"/>
                </StackPanel>
            </GroupBox>

            <!-- Current Status -->
            <GroupBox Header="Current Status" Padding="10" Margin="0,0,0,15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" 
                               Text="Active Flag: " 
                               FontWeight="Bold" 
                               Margin="0,0,10,10"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" 
                               x:Name="CurrentFlagText" 
                               Text="None"
                               Margin="0,0,0,10"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" 
                               Text="Status: " 
                               FontWeight="Bold" 
                               Margin="0,0,10,0"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" 
                               x:Name="StatusText" 
                               Text="Ready"
                               Foreground="Green"/>
                </Grid>
            </GroupBox>

            <!-- Device Selection -->
            <GroupBox Header="Active Buttons" Padding="10" Margin="0,0,0,15">
                <StackPanel>
                    <TextBlock Text="Select which GoXLR buttons to use for flag lighting:"
                               TextWrapping="Wrap"
                               Margin="0,0,0,10"/>
                    
                    <WrapPanel x:Name="ButtonSelectionPanel" Orientation="Horizontal">
                        <!-- Dynamically populated with checkboxes -->
                    </WrapPanel>
                </StackPanel>
            </GroupBox>

            <!-- Test Buttons -->
            <GroupBox Header="Test Flag Lighting" Padding="15" Margin="0,0,0,15">
                <StackPanel>
                    <TextBlock Text="Click buttons to test flag lighting (useful for testing without running the sim)"
                               TextWrapping="Wrap"
                               Foreground="Gray"
                               FontSize="11"
                               Margin="0,0,0,15"/>

                    <!-- Use UniformGrid for consistent button layout -->
                    <UniformGrid Columns="4" HorizontalAlignment="Left">
                        <!-- Row 1 -->
                        <Button Content="Green Flag" 
                                Click="TestFlag_Click" 
                                Tag="Green"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="#FF4CAF50"
                                Foreground="White"
                                ToolTip="Race start / Track clear"/>
                        
                        <Button Content="Yellow Flag" 
                                Click="TestFlag_Click" 
                                Tag="Yellow"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="#FFFFC107"
                                Foreground="Black"
                                ToolTip="Caution / No passing"/>
                        
                        <Button Content="Yellow Waving" 
                                Click="TestFlag_Click" 
                                Tag="YellowWaving"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="#FFFFC107"
                                Foreground="Black"
                                ToolTip="Danger ahead / No passing"/>
                        
                        <Button Content="Blue Flag" 
                                Click="TestFlag_Click" 
                                Tag="Blue"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="#FF2196F3"
                                Foreground="White"
                                ToolTip="Being lapped / Hold your line"/>
                        
                        <!-- Row 2 -->
                        <Button Content="White Flag" 
                                Click="TestFlag_Click" 
                                Tag="White"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="White"
                                Foreground="Black"
                                BorderBrush="Gray"
                                BorderThickness="1"
                                ToolTip="Final lap"/>
                        
                        <Button Content="Red Flag" 
                                Click="TestFlag_Click" 
                                Tag="Red"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="#FFF44336"
                                Foreground="White"
                                ToolTip="Session stopped"/>
                        
                        <Button Content="Black Flag" 
                                Click="TestFlag_Click" 
                                Tag="Black"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="Black"
                                Foreground="White"
                                ToolTip="Disqualification / Penalty"/>
                        
                        <Button Content="Checkered Flag" 
                                Click="TestFlag_Click" 
                                Tag="Checkered"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="WhiteSmoke"
                                Foreground="Black"
                                BorderBrush="Gray"
                                BorderThickness="1"
                                ToolTip="Session end"/>
                        
                        <!-- Row 3 -->
                        <Button Content="Debris Flag" 
                                Click="TestFlag_Click" 
                                Tag="Debris"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="#FFFF9800"
                                Foreground="Black"
                                ToolTip="Surface / Debris on track"/>
                        
                        <Button Content="One Lap to Green" 
                                Click="TestFlag_Click" 
                                Tag="OneLapToGreen"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="#FF8BC34A"
                                Foreground="White"
                                ToolTip="One lap until race restart"/>
                        
                        <Button Content="Clear Flag" 
                                Click="TestFlag_Click" 
                                Tag="None"
                                MinWidth="130"
                                Padding="12,8"
                                Margin="0,0,8,8"
                                Background="Gray"
                                Foreground="White"
                                ToolTip="Turn off all flag lights"/>
                    </UniformGrid>

                    <TextBlock Text="Note: Flashing flags will flash on your devices. Click 'Clear Flag' to stop."
                               TextWrapping="Wrap"
                               Foreground="Gray"
                               FontSize="11"
                               FontStyle="Italic"
                               Margin="0,15,0,0"/>
                </StackPanel>
            </GroupBox>

            <!-- Info -->
            <GroupBox Header="Information" Padding="10">
                <StackPanel>
                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                        <Run FontWeight="Bold">How it works:</Run>
                        <LineBreak/>
                        When you're racing in a sim, the system automatically detects flag changes and updates your lighting devices. No manual input needed!
                    </TextBlock>
                    
                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                        <Run FontWeight="Bold">Supported Devices:</Run>
                        <LineBreak/>
                        - GoXLR (Fader mute button LEDs)
                        <LineBreak/>
                        - More devices coming soon (Philips Hue, Nanoleaf, etc.)
                    </TextBlock>

                    <TextBlock TextWrapping="Wrap">
                        <Run FontWeight="Bold">Flashing Flags:</Run>
                        <LineBreak/>
                        Some flags flash to indicate urgent situations: Waving Yellow (caution), Black (disqualification), Checkered (race end).
                    </TextBlock>
                </StackPanel>
            </GroupBox>
        </StackPanel>
    </ScrollViewer>
</UserControl>
