<Window x:Class="SimControlCentre.Views.Tabs.SystemTrayAppPicker"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Select Application to Close" 
        Height="600" 
        Width="700"
    WindowStartupLocation="CenterOwner"
    ResizeMode="NoResize">
<Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
</Window.Resources>
<Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Instructions -->
        <TextBlock Grid.Row="0" 
                   TextWrapping="Wrap"
                   Margin="0,0,0,10">
            <Run Text="Select applications to close when iRacing starts."/>
            <LineBreak/>
            <Run Text="Includes windowed apps and system tray/background apps." FontSize="11" Foreground="Gray"/>
            <LineBreak/>
            <Run Text="This frees up CPU and RAM for better racing performance." FontSize="11" Foreground="Gray"/>
        </TextBlock>
        
        <!-- Search Box -->
        <TextBox Grid.Row="0"
                Name="SearchBox"
                Margin="0,60,0,10"
                Padding="8,5"
                TextChanged="SearchBox_TextChanged">
            <TextBox.Style>
                <Style TargetType="TextBox">
                    <Setter Property="Foreground" Value="Black"/>
                    <Style.Triggers>
                        <Trigger Property="Text" Value="">
                            <Setter Property="Background">
                                <Setter.Value>
                                    <VisualBrush Stretch="None" AlignmentX="Left">
                                        <VisualBrush.Visual>
                                            <TextBlock Text="Search applications..." 
                                                      Foreground="Gray" 
                                                      Margin="8,5,0,0"/>
                                        </VisualBrush.Visual>
                                    </VisualBrush>
                                </Setter.Value>
                            </Setter>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </TextBox.Style>
        </TextBox>
        
        <!-- UWP Warning -->
        <Border Grid.Row="0" 
                Background="#FFF9E6"
                BorderBrush="Orange"
                BorderThickness="1"
                Padding="10"
                Margin="0,110,0,15"
                CornerRadius="4">
            <StackPanel>
                <TextBlock FontWeight="Bold" Foreground="DarkOrange" Margin="0,0,0,5">
                    WARNING: Windows Store Apps (UWP) Not Supported
                </TextBlock>
                <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#666">
                    <Run Text="Apps like Xbox, Microsoft Store, and Windows Settings cannot be reliably closed."/>
                    <LineBreak/>
                    <Run Text="These apps use protected processes that require special permissions."/>
                    <LineBreak/>
                    <Run FontWeight="SemiBold" Text="Works with: "/>
                    <Run Text="Discord, Spotify, Chrome, Steam, and most traditional desktop apps"/>
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Apps List -->
        <Border Grid.Row="1" 
                BorderBrush="LightGray" 
                BorderThickness="1"
                Padding="5">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl Name="AppsListBox">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="LightGray"
                                   BorderThickness="0,0,0,1"
                                   Padding="10,8"
                                   Background="Transparent"
                                   MouseLeftButtonDown="AppItem_Click"
                                   Cursor="Hand">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Icon placeholder -->
                                    <Border Grid.Column="0" 
                                           Width="24" 
                                           Height="24" 
                                           Background="LightSteelBlue"
                                           CornerRadius="3"
                                           Margin="0,0,10,0">
                                        <TextBlock Text="App" 
                                                  FontSize="9" 
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"
                                                  Foreground="White"/>
                                    </Border>

                                    <!-- App info -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding ProcessName}" 
                                                      FontWeight="SemiBold" 
                                                      FontSize="13"/>
                                            <TextBlock Text=" (Main Window)" 
                                                      FontSize="11"
                                                      Foreground="Green"
                                                      FontWeight="Bold"
                                                      Margin="5,0,0,0"
                                                      Visibility="{Binding HasMainWindow, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        </StackPanel>
                                        <TextBlock Text="{Binding MainWindowTitle}" 
                                                  FontSize="10" 
                                                  Foreground="Gray"
                                                  TextTrimming="CharacterEllipsis"
                                                  MaxWidth="400"/>
                                        <TextBlock FontSize="9" 
                                                  Foreground="DarkGray"
                                                  TextTrimming="CharacterEllipsis"
                                                  MaxWidth="400">
                                            <Run Text="PID: "/><Run Text="{Binding ProcessId}"/>
                                            <Run Text=" | "/><Run Text="{Binding ExecutablePath}"/>
                                        </TextBlock>
                                    </StackPanel>

                                    <!-- Select button -->
                                    <TextBlock Grid.Column="2" 
                                              Text="?" 
                                              FontSize="16"
                                              Foreground="Gray"
                                              VerticalAlignment="Center"/>
                                </Grid>
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="AliceBlue"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <!-- Buttons -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,15,0,0">
            <Button Content="Cancel" 
                    Click="Cancel_Click"
                    Padding="20,8"
                    IsCancel="True"/>
        </StackPanel>
    </Grid>
</Window>
